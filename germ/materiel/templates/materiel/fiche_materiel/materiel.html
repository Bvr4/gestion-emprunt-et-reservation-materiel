{% extends 'materiel/base.html' %} 
{% block content %}

<header class="container">
    <h1>{{ materiel.identifiant }} - {{ materiel.nom }}</h1>
    <h4>{{ materiel.categorie }}, {{ materiel.emplacement }}</h3>
    <p>{{ materiel.description|linebreaks }}</p>
    {% if utilisateur.est_moderateur %}
        <a href="{% url 'editer-materiel' materiel.pk %}"><button>Editer les informations</button></a>
    {% endif %}
</header>
<main class="container">
    <section id="reservations">
    <h2>Voir sa disponiblité et procéder à une réservation</h2>

        {% if reservation_en_cours %}
            <p><mark>Réservation en cours :
                <a href="{% url 'utilisateur' reservation_en_cours.utilisateur.pk %}">{{ reservation_en_cours.utilisateur }},</a>
                 du {{ reservation_en_cours.date_debut_resa }} au {{ reservation_en_cours.date_fin_resa }}.
                 {% if reservation_en_cours.date_debut_emprunt %}
                    Emprunté depuis le {{ reservation_en_cours.date_debut_emprunt }}.
                 {% endif %}
                </mark>
            </p>

            {% if utilisateur.est_moderateur or utilisateur.peut_emprunter and utilisateur.pk == reservation_en_cours.utilisateur.pk %}
                {% include 'materiel/fiche_materiel/emprunter-materiel-bouton.html' with emprunt=reservation_en_cours %}
            {% endif %}
        {% endif %}

        {% if not materiel.empruntable %}
            <p><mark>Ce matériel n'est pas disponible à l'emprunt pour le moment.</mark></p>
        {% endif %}

        <h4>Prochaines réservations :</h4>
        {% if reservation_futures %}
            <table>
            <tr>
                <th><b>Emprunteur</b></th>
                <th><b>Date début réservation</b></th>
                <th><b>Date fin réservation</b></th>
            </tr>
            {% for reservation in reservation_futures %}
                <tr>
                    <td><a href="{% url 'utilisateur' reservation.utilisateur.pk %}">{{ reservation.utilisateur }}</a></td>
                    <td>{{ reservation.date_debut_resa }}</td>
                    <td>{{ reservation.date_fin_resa }}</td>
                </tr>
            {% endfor %}
            </table>
        {% else %}
            <p>Aucune réservation prévue pour ce matériel.</p>
        {% endif %}

        <h4>Réservations passées :</h4>
        {% if reservation_passees %}
            <table>
            <tr>
                <th><b>Emprunteur</b></th>
                <th><b>Date début réservation</b></th>
                <th><b>Date fin réservation</b></th>
                <th><b>Date début emprunt</b></th>
                <th><b>Date fin emprunt</b></th>
                <th><b>Cloturé</b></th>
            </tr>
            {% for reservation in reservation_passees %}
                <tr>
                    <td><a href="{% url 'utilisateur' reservation.utilisateur.pk %}">{{ reservation.utilisateur }}</a></td>
                    <td>{{ reservation.date_debut_resa }}</td>
                    <td>{{ reservation.date_fin_resa }}</td>
                    <td>{{ reservation.date_debut_emprunt|default_if_none:"-" }}</td>
                    <td>{{ reservation.date_fin_emprunt|default_if_none:"-" }}</td>
                    <td>{% if reservation.cloture %}Oui{% else %}Non{% endif %}</td>
                </tr>
            {% endfor %}
            </table>
        {% else %}
            <p>Aucune réservation passée pour ce matériel.</p>
        {% endif %}
        {% if utilisateur.peut_emprunter and materiel.empruntable %}
            {% include 'materiel/fiche_materiel/reserver-materiel-bouton.html' with materiel=materiel %}
        {% endif %}
    </section>

    <section id="commentaires">
        <h2>Commentaires</h2>
        <p>Donnez ici des informations sur le suivi du matériel (pannes, entretiens réalisés, frais éventuels...)</p>
               
        {% include 'materiel/fiche_materiel/creer-commentaire-bouton.html' with materiel=materiel %}

        {% for commentaire in commentaires %}
            {% include 'materiel/fiche_materiel/commentaire.html' with commentaire=commentaire %}
        {% endfor %}

    </section>

</main>

{% endblock content %}


